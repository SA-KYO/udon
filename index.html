<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GAS CORS テスト</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    button { padding: 0.5rem 1rem; background: #4f46e5; color: white; border: none; border-radius: 4px; }
    pre { background: #f3f4f6; padding: 1rem; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>GAS CORS テスト</h1>
  <button id="sendBtn">GAS に POST リクエストを送る</button>
  <pre id="log"></pre>

  <script>
    const btn = document.getElementById("sendBtn");
    const log = document.getElementById("log");

    // ↓ ここを、先ほどメモした GAS の exec URL に書き換えてください ↓
    const YOUR_EXEC_URL = "https://script.google.com/macros/s/AKfycbz2ydJIZTArnkNSCUpeFm8Kb73p9XjCsIfHb66sW97ElPl7DH9vH5N7fUsUS5ZF7l7Z/exec";

    btn.addEventListener("click", async () => {
      log.textContent = "送信中…";
      try {
        const payload = { test: "hello" };
        const res = await fetch(YOUR_EXEC_URL, {
          method: "POST",
          // 「単純リクエスト」にしてプリフライトを回避するため、必ず text/plain を指定します
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify(payload),
          // redirect: "follow" はデフォルトで有効なので省略可
        });
        log.textContent = `fetch status: ${res.status} ${res.statusText}\n`;
        const data = await res.json();
        log.textContent += `戻り値: ${JSON.stringify(data, null, 2)}\n`;
      } catch (err) {
        log.textContent = "通信に失敗しました。\n" + err;
      }
    });
  </script>
</body>
</html>
